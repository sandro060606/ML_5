<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Imagenes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.10/p5.min.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <main>
      <div class="container">
        <h2>Identificando Objetos</h2>
        <div class="row">
          <div class="col-md-6 mx-auto" id="contenedor">
            <!-- Aqui Canvas -->
            <!-- <div style="width: 400px; height: 400px;"></div> -->
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div
              id="barra1"
              class="progress mb-1"
              role="progressbar"
              aria-label="Basic Example"
              aria-valuenow="70"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              <div class="progress-bar text-bg-success"></div>
            </div>
            <div
              id="barra2"
              class="progress mb-1"
              role="progressbar"
              aria-label="Basic Example"
              aria-valuenow="20"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              <div class="progress-bar text-bg-info"></div>
            </div>
            <div
              id="barra3"
              class="progress mb-1"
              role="progressbar"
              aria-label="Basic Example"
              aria-valuenow="10"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              <div class="progress-bar text-bg-danger"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      // Objeto que permitira el Reconocimiento (Clasificador)
      let classifier;
      let img;
      let label = "";
      let confidence = "";
      //Lienzo donde se renderiza el resultado
      let canvas;

      //1. preload (precarga) - funcion ml5
      function preload() {
        //MobileNet = modelo basico entrenado de recononimiento
        classifier = ml5.imageClassifier("MobileNet");
        //Referenciar imagen fisica a identificar
        img = loadImage("images/animal2.jpg");
      }

      //2. configuracion - funcion ml5
      function setup() {
        //Canvas = lienzo (renderizar, pintar)
        canvas = createCanvas(400, 400);
        canvas.parent("contenedor");
        //Se pasa la imagen para su clasificacion, el resultado > funcion
        classifier.classify(img, gotResult);
        //Renderizar la imagen JPG en el canvas
        image(img, 0, 0, width, height);
      }

      function getPorcentual(value) {
        let porcentual = nf(value, 0, 2) * 100;
        return porcentual + '%';
      }

      // Callback function
      function gotResult(results) {
        //Mostrar resultados en consola
        console.log(results);

        document.querySelector("#barra1 .progress-bar").style.width =
          getPorcentual(results[0].confidence);
        document.querySelector("#barra1 .progress-bar").innerHTML =
          getPorcentual(results[0].confidence);

        document.querySelector("#barra2 .progress-bar").style.width =
          getPorcentual(results[1].confidence);
        document.querySelector("#barra2 .progress-bar").innerHTML =
          getPorcentual(results[1].confidence);

        document.querySelector("#barra3 .progress-bar").style.width =
          getPorcentual(results[2].confidence);
        document.querySelector("#barra3 .progress-bar").innerHTML =
          getPorcentual(results[2].confidence);
      }
    </script>
  </body>
</html>
